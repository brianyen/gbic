<html>
<body>
<div id="title">
    <h1><a id="titlelink" href="/">tubeslides</a></h1>
</div>

<div style="display: flex">
	<div id="metadata">
		<div id="m-url"><b>Video URL:</b> <a href=""></a></div>
        <div id="m-title"><b>Title:</b></div>
		<div id="m-creator"><b>Creator:</b></div>
		<div id="m-length"><b>Video Length:</b></div>
		<div id="description"><b>Description:</b></div>	
	</div>
	<div id="search">
		<form id="form" action="/convert_url">
			<input id="input" name="url"></input>
			<input type="submit" value="Go">
		</form>
	</div>
</div>

<div class="bar" style="margin-top: 0px"></div>

<div id="output">

</div> 

</body>
<script>
var id = "test"

outputEl = document.getElementById("output")

fetch("/v/" + id + "/vid.info.json")
.then(response => response.json().then(function(data) {
    var url = document.getElementById("m-url")
    var title = document.getElementById("m-title")
    var creator = document.getElementById("m-creator")
    var length = document.getElementById("m-length")
    var description = document.getElementById("description")
    
    var date = new Date(0);
    date.setSeconds(data.duration);
    var timeString = date.toISOString().substr(11, 8);


    url.innerHTML = '<b>Video URL: </b> <a href="' + data.webpage_url + '">' + data.webpage_url + '</a>'
    title.innerHTML = '<b>Title: </b>' + data.fulltitle
    creator.innerHTML = '<b>Creator: </b>' + data.uploader
    length.innerHTML = '<b>Video Length: </b>' + timeString
    description.innerHTML = "<b>Description</b>: " + data.description
    
}))

function processClip(i) {
    var clip = ('0000'+i).slice(-3);
    fetch("/v/" + id + "/clip-" + clip + "/slides.json")
    .then(response => response.json().then(function(data) {
        // console.log(data);
        for (let slide of data) {
        //     console.log(slide);
            var el = document.createElement("div")
            el.className = "group"
            s = '<img class="slide" src="/v/' +  id + '/' + slide.png + '">'
            s = s + '<div class="column">'
            for (let x of slide.text) {
                s = s + '<p class="paragraph"> <span class="timestamp">' + x.ts + ':</span> ' + x.text + '</p>'
            }
            s = s + "</div>"
            el.innerHTML = s

            var bar = document.createElement("div")
            bar.className = "bar"

            outputEl.appendChild(el)
            outputEl.appendChild(bar)
            processClip(i+1)
        }
    }))
}
processClip(0);

</script>
<style>
#titlelink {
	text-decoration: none;
	color: black;
}
#body {
	margin: 0px;
}
#title {
	text-align: center;
	font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
	padding: 1px;
	font-size: 25px;
}
#search {
	text-align: right;
	margin: 20px;
	width: 25%;
}
#input {
	width: 80%;
}
#metadata {
	padding: 0.5%;
	margin-left: 5%;
	font-size: 150%;
	font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
	color: rgb(30, 25, 90);
	width: 75%;
	word-wrap: break-word;
	overflow-x: hidden;
}
#description {
	font-size: 75%;
}
#form {
	display: flex;
}
.bar {
	border-top: 3px solid rgb(200, 200, 200);
	padding: 0px;
	margin: 50px;
	height: 0px;
}
.group {
	padding-bottom: 10px;
}
.slide {
	width: 100%;
	position: sticky;
	top: 0px;
	border-bottom: 3px solid rgb(200, 200, 200);
	background-color: white;
}
.paragraph {
	margin: 5%;
	font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
	width: 90%;
	word-wrap: break-word;
	overflow-x: hidden;
	font-size: 125%;
	margin-bottom: 0px;
	margin-top: 1%;
}
.timestamp {
	font-size: 75%;
}
.error {
	font-size: 150%;
	margin-left: 5%;
	font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
	color: rgb(225, 40, 40);
}
@media only screen and (min-width: 768px) {
	.group {
		display: flex;
	}
	div.column {
		width: 50%;
	}
	.slide {
		width: 40%;
		height: 100%;
		top: 20px;
		margin: 5%;
		margin-top: 0px;
		border: 3px solid rgb(200, 200, 200);
	}
}
</style>
</html>